---
title: "sim_Li_2009"
author: "Xuelong Wang"
date: "12/1/2017"
output: html_document
---


```{r, include=FALSE}
setwd("~/dev/projects/inverse_regression/R_code/Li_2009/")
root_path <- "../../../../dr_sim_data/"

####################################################################
source("../sir_helpers.R")
source("simulation_generation_Li_2009.R")
library(dr)
#####################################################################
```

# Comparison the block method with dr package and result 

```{r, include=FALSE}
library(doParallel)
registerDoParallel(4)
for (i in 3:6) {
input <- prepare_input(paste0(i, "_Li_2009"), root_path)

result_block <- mapply(FUN = SIR_blocks, 
                group_name = input$data_list, 
                  MoreArgs = list(slice_levels = letters[1:input$slice_number], 
                                         block = input$block, 
                                     root_path = root_path),
                  SIMPLIFY = FALSE)

test_result_block <- mapply(dr_test_sir, object = result_block, SIMPLIFY = FALSE)

## dir
result_dr <- list()
for( f in input$data_list){
  input_data <- read.csv(paste0(root_path, f, ".csv"))
  result_dr <- append(result_dr, list(dr(y ~., data = input_data[, -ncol(input_data)], method = "sir", nslice = input$slice_number, slice.function=dr.slices.arc)))
}
names(result_dr) <- input$data_list

test_result_dr <- mapply(dr.test, object = result_dr, SIMPLIFY = FALSE)

for ( i in 1:length(input$data_list)) {
  print(test_result_block[i])
  print(test_result_dr[i])
  cat("#########################################################\n")
}

}
```
