---
title: "Untitled"
author: "Xuelong Wang"
date: "12/1/2017"
output: html_document
---


```{r, include=FALSE}
setwd("~/dev/projects/inverse_regression/R_code/")
root_path <- "../sim_data/"

####################################################################
source("sir_helpers.R")
source("simulation_generation.R")
library(dr)
#####################################################################
```

# Comparison the block method with dr package and result 

```{r, include=FALSE}
input <- prepare_input("Li_2009", root_path)

result_block <- mapply(FUN = SIR_blocks, 
                group_name = input$data_list, 
                  MoreArgs = list(slice_levels = letters[1:input$slice_number], 
                                         block = input$block, 
                                     root_path = root_path),
                  SIMPLIFY = FALSE)

test_result_block <- mapply(dr_test_sir, object = result_block, SIMPLIFY = FALSE)

## dir
result_dr <- list()
for( f in input$data_list){
  input_data <- read.csv(paste0(root_path, f, ".csv"))
  result_dr <- append(result_dr, list(dr(y ~., data = input_data[, -ncol(input_data)], method = "sir", nslice = input$slice_number)))
}
names(result_dr) <- input$data_list

test_result_dr <- mapply(dr.test, object = result_dr, SIMPLIFY = FALSE)
```

```{r, echo=FALSE}
for ( i in 1:length(input$data_list)) {
  print(test_result_block[i])
  print(test_result_dr[i])
  cat("#########################################################\n")
}
```
```{r, include=FALSE}
input <- prepare_input("mussles", root_path)

result_block <- mapply(FUN = SIR_blocks, 
                group_name = input$data_list, 
                  MoreArgs = list(slice_levels = letters[1:input$slice_number], 
                                         block = input$block, 
                                     root_path = root_path),
                  SIMPLIFY = FALSE)

test_result_block <- mapply(dr_test_sir, object = result_block, SIMPLIFY = FALSE)

## dir
result_dr <- list()
for( f in input$data_list){
  input_data <- read.csv(paste0(root_path, f, ".csv"))
  result_dr <- append(result_dr, list(dr(y ~., data = input_data[, -ncol(input_data)], method = "sir", nslice = input$slice_number)))
}
names(result_dr) <- input$data_list

test_result_dr <- mapply(dr.test, object = result_dr, SIMPLIFY = FALSE)
```
```{r, echo=FALSE}
for ( i in 1:length(input$data_list)) {
  print(test_result_block[i])
  print(test_result_dr[i])
  cat("#########################################################\n")
}
```